<div class="row">
  <% 
    if (user_signed_in?)
      tenantInfoWidth = "col-md-4 offset-md-1"
      associatedMeterWidth = "col-md-5"
    else
      tenantInfoWidth = "col-12"
      associatedMeterWidth=""
    end
  %>
  <div class="<%= tenantInfoWidth %> text-center">
    <%= image_tag "logo.jpg", class: "contact-image rounded-circle" %>
    <h2>
      <%= @tenant.name %>
    </h2>
    </br>
    <% if (user_signed_in?) %>      
      <h5>
        <%= @tenant.email %>
      </h5>
      <h5>
        <%= @tenant.phone %>
      </h5>
      </br>
    <% end %>
    <span class="text-muted text-uppercase">amount due</span>
    <h3 class="large-currency">
      <sup>$</sup><%= @tenant.amount_due %>
    </h3>
    <% if (@tenant.amount_due > 0) %><button class="btn-outline-primary">Pay Now</button><% end %>
  </div>

  <% if (user_signed_in?) %>
    <div class="col-md-1"></div>
    <div class="<%= associatedMeterWidth %> h-100" >          
      <h3>Associated Meters</h3>
        <div class="table-header-row">
          <div class='table-row-item meter-item'>
            <div class="table-cell reference">Reference</div>
            <div class="table-cell allocation">Allocation</div>
            <div class="table-cell link">Delete</div>
          </div>
        </div>
      <div id="meter-list">
        <div class="table h-100">
          <% 
          if (@tenant.billable_meters.count > 0)
            @tenant.billable_meters.each do |meter| 
              if (meter.description?) 
                meter_reference = meter.description 
              else 
                meter_reference = meter.meter.reference 
              end  %>
              <div class="table-row">
                <div class='table-row-item meter-item'>
                  <div class="table-cell reference">
                    <%= meter_reference %>                  
                  </div>
                  <div class="table-cell allocation"><%= meter.percent_allocation %>%</div>
                  <div class="table-cell link"><%= link_to 'âœ•', meter, method: :delete, data: { confirm: "Are you sure you would like to remove this meter from " + @tenant.name + "?" } %></div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="table-row">
              <div class='table-row-item meter-item'>
                <div class="table-cell">
                   No meters have been associated with this tenant.  <%= link_to 'Add One', new_billable_meter_path(tenant: @tenant), remote: true %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <%= link_to 'Associate a Meter', new_billable_meter_path(tenant: @tenant), remote: true %>
    </div>
  <% end %>
</div>

</br>
</br>

<div class="row">
  <div class="col-10 col-md-10 offset-md-1">
    <% if (user_signed_in?) %>
      <h2>Invoices</h2>
    <% end %>
    <table class="table">
      <thead>
        <tr>
          <th width="70%">Invoice</th>
          <th width="15%" class="text-center">Amount</th>
          <th width="15%" class="text-center">Status</th>
        </tr>
      </thead>

      <tbody>
        <% @tenant.invoices.order(end_date: :desc).each do |invoice| %>
          <tr class="clickable-row">
            <td width="70%"><%= invoice.readable_date %></td>
            <td width="15%" class="text-center"><sup>$</sup><%= invoice.amount %></td>
            <td width="15%" class="text-center"><%= invoice.status %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
  
