<div class="row h-100 lightbox">
  <button type="button" class="close" aria-label="Close" onclick="closeLightbox();">
    <span aria-hidden="true">&times;</span>
  </button>
  <div class="col-12 text-center my-auto">
    
    <h1 class="text-center">Configure a Meter</h1>
    <h3 class="text-muted text-uppercase">for <%= @tenant.name %></h3>
    <hr style="padding: 0 40px;"/>
    </br>

    <%= form_for(billable_meter, html: {class: "h-100",remote:true}) do |f| %>
      
      <div class="row h-100">

        <% if billable_meter.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(billable_meter.errors.count, "error") %> prohibited this billable_meter from being saved:</h2>

          <ul>
          <% billable_meter.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

        <div  class="col-xs-12 col-md-6">
        <h3>Data Source</h3>
        <div id="meter-list">

          <div class="table">    
          <% current_site.meters.each do |meter| %>
            <div class="table-row">
              <div class='table-row-item space-item clickable-row' id="<%= meter.id %>" >
                <div class="table-cell full-width"><%= meter.reference %></div>
              </div>
            </div>
          <% end %>
          </div>
        </div>

        <div class="field">
          <input type="text" id="meter-filter" onkeyup="filterList()" placeholder="Filter points..">
        </div>
      </div>

        <div class="col-xs-12 col-md-6">
          <h3>Options</h3>
          <div class="field">
            <%= f.text_field :description, placeholder: "description (optional)", size: 200 %>
          </div>
          </br>
          <div class="field">            
            <%= f.number_field :percent_allocation, placeholder: "\% Allocation (100\% if blank)", size: 200 %>
          </div>
          </br>
          
          <div class="field">
            <% defaultOption = options_for_select([['Rate',nil]]) %>
            <% options = options_from_collection_for_select(current_user.rates, 'id', 'symbol') %>
            <%= f.select :rate_id,  defaultOption << options %>
          </div>
          </br>

          <%= f.hidden_field :meter_id, :id => "meter-id" %>
          <%= f.hidden_field :tenant_id, :value => @tenant.id %>

          <div class="actions">
            <%= f.submit id: "login-button", class: "btn-outline-primary", value: "Create" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script type="text/javascript">

  jQuery(document).ready(function($) {    
    $(".clickable-row").mousedown(function() {
      $(".clickable-row").removeClass("selected")
      selectedMeter = $(this)
      selectedMeter.addClass("selected")
      $('#meter-id').val(selectedMeter.attr('id'));
    });
  });

  function filterList() {
    // Declare variables
    var input, filter, ul, li, a, i;
    input = document.getElementById('meter-filter');
    filter = input.value.toUpperCase();
    ul = document.getElementById("meter-list");
    li = ul.getElementsByClassName('table-row');

    // Loop through all list items, and hide those who don't match the search query
    for (i = 0; i < li.length; i++) {
      a = li[i].getElementsByClassName("table-row-item")[0];
      if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
          li[i].style.display = "";
      } else {
          li[i].style.display = "none";
      }
    }
  }

</script>